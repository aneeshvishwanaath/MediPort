{
  "entities": {
    "Patient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patient",
      "type": "object",
      "description": "Represents a patient in the MediPort system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Patient entity, same as user UID."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who owns/created this patient record."
        },
        "medicalPortfolioId": {
          "type": "string",
          "description": "Globally unique Medical Portfolio ID (MPI) for the patient."
        },
        "firstName": {
          "type": "string",
          "description": "Patient's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Patient's last name."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "Patient's date of birth.",
          "format": "date"
        },
        "age": {
          "type": "number",
          "description": "Patient's age."
        },
        "gender": {
          "type": "string",
          "description": "Patient's gender."
        },
        "height": {
          "type": "number",
          "description": "Patient's height in cm."
        },
        "weight": {
          "type": "number",
          "description": "Patient's weight in kg."
        },
        "bloodGroup": {
          "type": "string",
          "description": "Patient's blood group."
        },
        "occupation": {
          "type": "string",
          "description": "Patient's occupation."
        },
        "village": {
          "type": "string",
          "description": "Patient's village or locality."
        },
        "personalHistory": {
          "type": "string",
          "description": "General personal history notes."
        },
        "cancerHistory": {
          "type": "string",
          "description": "Details of any cancer history."
        },
        "otherMedicines": {
          "type": "string",
          "description": "Use of alternative medicines like Ayurveda, Homeopathy."
        },
        "bowelHabits": {
          "type": "string",
          "description": "Notes on patient's bowel habits."
        },
        "geneticHistory": {
          "type": "string",
          "description": "Details of patient's genetic history."
        },
        "identificationMarks": {
          "type": "string",
          "description": "Visible identification marks on the patient's body."
        },
        "pastMedications": {
          "type": "array",
          "description": "A list of past medications taken by the patient.",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "reason": { "type": "string" },
              "discontinued": { "type": "string" }
            }
          }
        },
        "surgeries": {
          "type": "array",
          "description": "A list of surgeries or procedures for the patient.",
          "items": {
            "$ref": "#/entities/Surgery"
          }
        }
      },
      "required": [
        "id",
        "ownerId",
        "medicalPortfolioId",
        "firstName",
        "lastName",
        "dateOfBirth",
        "age",
        "gender"
      ]
    },
    "Doctor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Doctor",
      "type": "object",
      "description": "Represents a doctor in the MediPort system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Doctor entity."
        },
        "firstName": {
          "type": "string",
          "description": "Doctor's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Doctor's last name."
        },
        "specialization": {
          "type": "string",
          "description": "Doctor's area of specialization."
        },
        "hospitalId": {
          "type": "string",
          "description": "Reference to Hospital. (Relationship: Hospital 1:N Doctor)"
        }
      },
      "required": ["id", "firstName", "lastName", "specialization"]
    },
    "Hospital": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hospital",
      "type": "object",
      "description": "Represents a hospital or clinic in the MediPort system.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "address": { "type": "string" }
      },
      "required": ["id", "name", "address"]
    },
    "Pharmacy": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pharmacy",
      "type": "object",
      "description": "Represents a pharmacy or chemist in the MediPort system.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "address": { "type": "string" }
      },
      "required": ["id", "name", "address"]
    },
    "DiagnosticLab": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DiagnosticLab",
      "type": "object",
      "description": "Represents a diagnostic laboratory in the MediPort system.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "address": { "type": "string" }
      },
      "required": ["id", "name", "address"]
    },
    "MedicalReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MedicalReport",
      "type": "object",
      "description": "Represents a medical report for a patient.",
      "properties": {
        "id": { "type": "string" },
        "patientId": { "type": "string" },
        "uploadedByLabId": { "type": "string" },
        "reportName": { "type": "string" },
        "reportType": { "type": "string" },
        "reportCategory": { "type": "string" },
        "uploadDate": { "type": "string", "format": "date" },
        "fileUrl": { "type": "string", "format": "uri" }
      },
      "required": [
        "id",
        "patientId",
        "uploadedByLabId",
        "reportName",
        "reportType",
        "uploadDate",
        "fileUrl"
      ]
    },
    "Prescription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prescription",
      "type": "object",
      "description": "Represents a prescription for a patient.",
      "properties": {
        "id": { "type": "string" },
        "patientId": { "type": "string" },
        "doctorId": { "type": "string" },
        "doctorName": { "type": "string" },
        "medicationName": { "type": "string" },
        "dosage": { "type": "string" },
        "frequency": { "type": "string" },
        "startDate": { "type": "string", "format": "date" },
        "endDate": { "type": "string", "format": "date" }
      },
      "required": [
        "id",
        "patientId",
        "doctorId",
        "doctorName",
        "medicationName",
        "dosage",
        "startDate"
      ]
    },
    "Surgery": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Surgery",
      "type": "object",
      "description": "Represents a surgery or procedure.",
      "properties": {
        "id": { "type": "string" },
        "patientId": { "type": "string" },
        "procedureName": { "type": "string" },
        "date": { "type": "string", "format": "date" },
        "notes": { "type": "string" }
      },
      "required": ["id", "patientId", "procedureName", "date"]
    },
    "EmergencyContact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmergencyContact",
      "type": "object",
      "description": "Represents an emergency contact for a patient.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "relation": { "type": "string" },
        "phone": { "type": "string" }
      },
      "required": ["id", "name", "relation", "phone"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the system.",
      "properties": {
        "uid": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "role": { "type": "string", "enum": ["patient", "doctor", "chemist", "lab"] }
      },
      "required": ["uid", "email", "role"]
    }
  },
  "auth": {
    "providers": ["password", "anonymous"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores user account information, including email and role."
        }
      },
      {
        "path": "/roles_doctor/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Indicates a user has the 'doctor' role."
        }
      },
      {
        "path": "/roles_patient/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Indicates a user has the 'patient' role."
        }
      },
      {
        "path": "/roles_chemist/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Indicates a user has the 'chemist' role."
        }
      },
      {
        "path": "/roles_lab/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Indicates a user has the 'lab' role."
        }
      },
      {
        "path": "/patients/{patientId}",
        "definition": {
          "schema": { "$ref": "#/entities/Patient" },
          "description": "Top-level collection for all patient profiles."
        }
      },
      {
        "path": "/patients/{patientId}/medicalReports/{reportId}",
        "definition": {
          "schema": { "$ref": "#/entities/MedicalReport" },
          "description": "Subcollection for a patient's medical reports."
        }
      },
      {
        "path": "/patients/{patientId}/prescriptions/{prescriptionId}",
        "definition": {
          "schema": { "$ref": "#/entities/Prescription" },
          "description": "Subcollection for a patient's prescriptions."
        }
      },
      {
        "path": "/patients/{patientId}/surgeries/{surgeryId}",
        "definition": {
          "schema": { "$ref": "#/entities/Surgery" },
          "description": "Subcollection for a patient's surgeries."
        }
      },
      {
        "path": "/patients/{patientId}/emergencyContacts/{contactId}",
        "definition": {
          "schema": { "$ref": "#/entities/EmergencyContact" },
          "description": "Subcollection for a patient's emergency contacts."
        }
      },
      {
        "path": "/doctors/{doctorId}",
        "definition": {
          "schema": { "$ref": "#/entities/Doctor" },
          "description": "Stores doctor profiles."
        }
      },
      {
        "path": "/pharmacies/{pharmacyId}",
        "definition": {
          "schema": { "$ref": "#/entities/Pharmacy" },
          "description": "Stores pharmacy profiles."
        }
      },
      {
        "path": "/diagnosticLabs/{labId}",
        "definition": {
          "schema": { "$ref": "#/entities/DiagnosticLab" },
          "description": "Stores diagnostic lab profiles."
        }
      }
    ],
    "reasoning": "The Firestore structure is refactored to use a top-level `/patients` collection. This is a more scalable and query-efficient approach for a multi-tenant system where doctors, chemists, and labs need to access records from multiple patients. It avoids deep nesting and complex collection group queries for primary workflows. Role-based access control is managed via `firestore.rules` which checks a user's role against the operation they are trying to perform on the `/patients` collection and its subcollections. This design simplifies data access patterns while maintaining security."
  }
}
